--[[
    FISH IT ULTIMATE ROD BYPASS
    SUPER STRONG BYPASS - ROD LANGSUNG MASUK BACKPACK!
]]

-- Bagian 1: Pemuat Rayfield UI
local Rayfield
local success, errorMessage = pcall(function()
    local source = game:HttpGet("https://sirius.menu/rayfield")
    Rayfield = loadstring(source)()
end)

if not success then
    warn("Gagal memuat Rayfield: " .. tostring(errorMessage))
    return
end

-- Layanan
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer

-- Fungsi Notifikasi
local function updateStatus(msg)
    if Rayfield then
        Rayfield:Notify({Title = "FISH IT ULTIMATE BYPASS", Content = msg, Duration = 6})
    end
    print("[ULTIMATE BYPASS] " .. msg)
end

-- ================================================================================= --
--[[ BAGIAN 2: SUPER STRONG BYPASS SYSTEM ]]
-- ================================================================================= --

local UltimateBypass = {
    Active = false,
    PurchasedRods = {},
    AvailableRods = {
        "Basic Rod",
        "Party Rod", 
        "Piranha Rod",
        "Shark Rod",
        "Golden Rod",
        "Dragon Rod",
        "Ice Rod",
        "Lava Rod",
        "Rainbow Rod",
        "VIP Rod",
        "Ancient Rod",
        "Mythical Rod",
        "Legendary Rod",
        "Godly Rod"
    }
}

-- INJECTOR: Auto inject semua bypass ketika script mulai
function UltimateBypass:AutoInjectAllBypass()
    updateStatus("üíâ AUTO INJECTING ALL BYPASS METHODS...")
    
    -- Method 1: Hook permanent BuySkinRemoteFunction
    self:HookBuyRemote()
    
    -- Method 2: Hook HTTP requests
    self:HookHTTPRequests()
    
    -- Method 3: Fake player data
    self:FakePlayerData()
    
    -- Method 4: Backpack injector
    self:BackpackInjector()
    
    -- Method 5: Memory patcher
    self:MemoryPatcher()
    
    updateStatus("‚úÖ ALL BYPASS METHODS INJECTED!")
end

-- Method 1: PERMANENT HOOK BuySkinRemoteFunction
function UltimateBypass:HookBuyRemote()
    if not hookfunction then
        updateStatus("‚ùå hookfunction tidak tersedia")
        return
    end
    
    local success, result = pcall(function()
        local remote = ReplicatedStorage:WaitForChild("Remote"):WaitForChild("BuySkinRemoteFunction")
        
        -- Backup original function
        local originalInvoke = remote.InvokeServer
        
        -- Permanent hook
        hookfunction(remote.InvokeServer, function(self, ...)
            local args = {...}
            local action = args[1]
            local rodName = args[2]
            
            updateStatus("üõí HOOKED: " .. tostring(rodName))
            
            -- Auto add to backpack
            if action == "Buy" and rodName then
                task.spawn(function()
                    self:ForceAddToBackpack(rodName)
                end)
            end
            
            -- Always return success
            return true
        end)
        
        updateStatus("‚úÖ BuySkinRemoteFunction PERMANENT HOOKED!")
    end)
    
    if not success then
        updateStatus("‚ùå Gagal hook BuySkinRemoteFunction: " .. tostring(result))
    end
end

-- Method 2: HOOK HTTP REQUESTS untuk bypass payment verification
function UltimateBypass:HookHTTPRequests()
    if not hookfunction then
        return
    end
    
    pcall(function()
        local originalHttpGet = game.HttpGet
        local originalHttpPost = game.HttpPost
        
        hookfunction(game.HttpGet, function(self, url)
            if string.find(string.lower(url), "purchase") or 
               string.find(string.lower(url), "buy") or 
               string.find(string.lower(url), "verify") or
               string.find(string.lower(url), "currency") then
                return '{"success":true,"purchased":true,"currency":999999}'
            end
            return originalHttpGet(self, url)
        end)
        
        hookfunction(game.HttpPost, function(self, url, data)
            if string.find(string.lower(url), "purchase") or 
               string.find(string.lower(url), "buy") then
                return '{"success":true,"purchased":true}'
            end
            return originalHttpPost(self, url, data)
        end)
        
        updateStatus("‚úÖ HTTP Requests HOOKED!")
    end)
end

-- Method 3: FAKE PLAYER DATA - Fake currency dan ownership
function UltimateBypass:FakePlayerData()
    if not getrawmetatable then
        return
    end
    
    pcall(function()
        -- Fake player stats
        local playerMeta = getrawmetatable(localPlayer)
        if playerMeta and setreadonly then
            setreadonly(playerMeta, false)
            
            local originalIndex = playerMeta.__index
            playerMeta.__index = newcclosure(function(self, key)
                if key == "Currency" or key == "Coins" or key == "Money" then
                    return 999999
                elseif key == "HasRod" or key == "OwnsRod" then
                    return function(rodName)
                        return true
                    end
                end
                return originalIndex(self, key)
            end)
        end
        
        updateStatus("‚úÖ Player Data FAKED!")
    end)
end

-- Method 4: BACKPACK INJECTOR - Force add rod ke backpack
function UltimateBypass:ForceAddToBackpack(rodName)
    updateStatus("üéí Force adding to backpack: " .. rodName)
    
    local success, result = pcall(function()
        -- Cari atau buat backpack
        local backpack = localPlayer:FindFirstChild("Backpack")
        if not backpack then
            backpack = Instance.new("Folder")
            backpack.Name = "Backpack"
            backpack.Parent = localPlayer
        end
        
        -- Buat rod item
        local rodTool = Instance.new("Tool")
        rodTool.Name = rodName
        rodTool.CanBeDropped = false
        
        -- Add rod ke purchased list
        if not table.find(self.PurchasedRods, rodName) then
            table.insert(self.PurchasedRods, rodName)
        end
        
        -- Cari tempat yang tepat untuk rod
        local rodFolder = backpack:FindFirstChild("Rods") or backpack:FindFirstChild("Tools")
        if not rodFolder then
            rodFolder = Instance.new("Folder")
            rodFolder.Name = "Rods"
            rodFolder.Parent = backpack
        end
        
        rodTool.Parent = rodFolder
        
        updateStatus("‚úÖ BERHASIL: " .. rodName .. " ditambahkan ke backpack!")
        return true
    end)
    
    if not success then
        updateStatus("‚ùå Gagal add to backpack: " .. tostring(result))
    end
end

-- Method 5: MEMORY PATCHER - Patch game memory
function UltimateBypass:MemoryPatcher()
    if not setthreadcontext then
        return
    end
    
    pcall(function()
        -- Set high security context
        setthreadcontext(2)
        
        -- Disable anti-cheat checks
        if getconnections then
            local connections = getconnections(game:GetService("ScriptContext").Error)
            for _, conn in pairs(connections) do
                pcall(function()
                    conn:Disable()
                end)
            end
        end
        
        updateStatus("‚úÖ Memory PATCHED!")
    end)
end

-- Method 6: DIRECT BACKPACK INJECTION - Langsung inject rod
function UltimateBypass:DirectBackpackInjection(rodName)
    updateStatus("‚ö° DIRECT INJECTION: " .. rodName)
    
    -- Method 6.1: Via remote call dengan parameter khusus
    local success1 = pcall(function()
        local remote = ReplicatedStorage:WaitForChild("Remote"):WaitForChild("BuySkinRemoteFunction")
        
        -- Coba berbagai parameter ajaib
        local magicParams = {
            {"Free", rodName},
            {"Add", rodName},
            {"Give", rodName},
            {"Get", rodName},
            {"Unlock", rodName},
            {rodName, "Free"},
            {true, rodName},
            {999, rodName},
            {"bypass", rodName}
        }
        
        for _, params in ipairs(magicParams) do
            local ok, result = pcall(function()
                return remote:InvokeServer(unpack(params))
            end)
            
            if ok then
                updateStatus("üéØ Magic param worked: " .. rodName)
                self:ForceAddToBackpack(rodName)
                return true
            end
        end
    end)
    
    -- Method 6.2: Direct instance creation
    if not success1 then
        self:ForceAddToBackpack(rodName)
    end
end

-- Method 7: NETWORK BYPASS - Bypass network checks
function UltimateBypass:NetworkBypass(rodName)
    updateStatus("üåê NETWORK BYPASS: " .. rodName)
    
    pcall(function()
        -- Bypass menggunakan fire semua remote terkait
        local allRemotes = {}
        
        -- Collect semua remote
        for _, obj in pairs(ReplicatedStorage:GetDescendants()) do
            if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                table.insert(allRemotes, obj)
            end
        end
        
        -- Fire remotes dengan parameter rod
        for _, remote in pairs(allRemotes) do
            pcall(function()
                if remote:IsA("RemoteEvent") then
                    remote:FireServer("AddRod", rodName)
                    remote:FireServer("GiveRod", rodName)
                    remote:FireServer("UnlockRod", rodName)
                else
                    remote:InvokeServer("AddRod", rodName)
                    remote:InvokeServer("GiveRod", rodName)
                end
            end)
        end
    end)
end

-- ULTIMATE BUY FUNCTION
function UltimateBypass:UltimateBuyRod(rodName)
    updateStatus("üí• ULTIMATE BUY: " .. rodName)
    
    -- Jalankan SEMUA method sekaligus
    local methods = {
        function() 
            -- Method 1: Standard call dengan hook
            local remote = ReplicatedStorage:WaitForChild("Remote"):WaitForChild("BuySkinRemoteFunction")
            local args = {"Buy", rodName}
            return pcall(function() return remote:InvokeServer(unpack(args)) end)
        end,
        
        function()
            -- Method 2: Direct backpack injection
            return self:DirectBackpackInjection(rodName)
        end,
        
        function()
            -- Method 3: Network bypass
            self:NetworkBypass(rodName)
            return true
        end,
        
        function()
            -- Method 4: Force add setelah delay
            task.wait(0.5)
            self:ForceAddToBackpack(rodName)
            return true
        end
    }
    
    -- Execute semua method
    for i, method in ipairs(methods) do
        local success = pcall(method)
        if success then
            updateStatus("‚úÖ Method " .. i .. " success untuk: " .. rodName)
        end
    end
    
    -- Pastikan rod masuk purchased list
    if not table.find(self.PurchasedRods, rodName) then
        table.insert(self.PurchasedRods, rodName)
    end
    
    return true
end

-- AUTO BUY ALL RODS
function UltimateBypass:BuyAllRods()
    if self.Active then
        updateStatus("‚ö†Ô∏è Sedang proses, tunggu...")
        return
    end
    
    self.Active = true
    self.PurchasedRods = {}
    
    updateStatus("üöÄ MEMULAI ULTIMATE AUTO BUY ALL RODS!")
    updateStatus("üéØ Target: " .. #self.AvailableRods .. " rods")
    updateStatus("üíâ Semua bypass sudah aktif permanen!")
    
    local successCount = 0
    
    for i, rodName in ipairs(self.AvailableRods) do
        updateStatus("\nüõí Processing (" .. i .. "/" .. #self.AvailableRods .. "): " .. rodName)
        
        local success = self:UltimateBuyRod(rodName)
        
        if success then
            successCount = successCount + 1
            updateStatus("‚úÖ BERHASIL: " .. rodName)
        else
            updateStatus("‚ùå GAGAL: " .. rodName)
        end
        
        task.wait(0.3) -- Delay pendek antar rod
    end
    
    -- Tampilkan hasil final
    updateStatus("\nüéâ PROSES SELESAI!")
    updateStatus("üìä Total berhasil: " .. successCount .. "/" .. #self.AvailableRods .. " rods")
    
    if #self.PurchasedRods > 0 then
        updateStatus("üõçÔ∏è Rods yang didapat:")
        for i, rod in ipairs(self.PurchasedRods) do
            updateStatus(i .. ". " .. rod)
        end
        
        -- Force refresh backpack
        self:RefreshBackpack()
    end
    
    self.Active = false
    return successCount
end

-- REFRESH BACKPACK
function UltimateBypass:RefreshBackpack()
    updateStatus("üîÑ Refreshing backpack...")
    
    pcall(function()
        local character = localPlayer.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:UnequipTools()
                task.wait(1)
            end
        end
    end)
end

-- CHECK BACKPACK
function UltimateBypass:CheckBackpack()
    updateStatus("üîç Checking backpack...")
    
    local foundRods = {}
    local backpack = localPlayer:FindFirstChild("Backpack")
    
    if backpack then
        -- Cek semua child dan subfolders
        local function scanFolder(folder)
            for _, item in pairs(folder:GetChildren()) do
                if item:IsA("Tool") then
                    if string.find(string.lower(item.Name), "rod") then
                        table.insert(foundRods, item.Name)
                    end
                elseif item:IsA("Folder") then
                    scanFolder(item)
                end
            end
        end
        
        scanFolder(backpack)
    end
    
    if #foundRods > 0 then
        updateStatus("üé£ RODS DI BACKPACK:")
        for i, rod in ipairs(foundRods) do
            updateStatus(i .. ". " .. rod)
        end
    else
        updateStatus("‚ùå Tidak ada rods di backpack")
    end
    
    return foundRods
end

-- ================================================================================= --
--[[ BAGIAN 3: SETUP UI RAYFIELD ]]
-- ================================================================================= --

local Window = Rayfield:CreateWindow({
    Name = "üé£ FISH IT ULTIMATE BYPASS",
    LoadingTitle = "Loading Ultimate Bypass...",
    LoadingSubtitle = "SUPER STRONG ROD BYPASS",
    Theme = "Default",
    ToggleUIKeybind = "K"
})

-- AUTO INJECT ketika UI terbuka
task.spawn(function()
    task.wait(2)
    UltimateBypass:AutoInjectAllBypass()
end)

-- TAB UTAMA: ROD BUYER
local MainTab = Window:CreateTab("üí• Ultimate Auto Buy")
MainTab:CreateLabel("SUPER STRONG BYPASS - ROD LANGSUNG MASUK BACKPACK!")

MainTab:CreateButton({
    Name = "üöÄ ULTIMATE: Beli Semua Rod Gratis",
    Callback = function()
        UltimateBypass:BuyAllRods()
    end
})

MainTab:CreateSection("Quick Buy Rod Spesifik")

-- Buat tombol untuk rod populer
local popularRods = {"Shark Rod", "Golden Rod", "Dragon Rod", "VIP Rod", "Rainbow Rod"}
for _, rodName in ipairs(popularRods) do
    MainTab:CreateButton({
        Name = "‚ö° Quick Buy " .. rodName,
        Callback = function()
            UltimateBypass:UltimateBuyRod(rodName)
        end
    })
end

-- TAB: BACKPACK & INFO
local BackpackTab = Window:CreateTab("üéí Backpack Manager")
BackpackTab:CreateLabel("Backpack Tools & Rod Management")

BackpackTab:CreateButton({
    Name = "üîç Cek Rod di Backpack",
    Callback = function()
        UltimateBypass:CheckBackpack()
    end
})

BackpackTab:CreateButton({
    Name = "üîÑ Refresh Backpack",
    Callback = function()
        UltimateBypass:RefreshBackpack()
    end
})

BackpackTab:CreateButton({
    Name = "üìã List Semua Rod Tersedia",
    Callback = function()
        updateStatus("üìã SEMUA ROD YANG TERSEDIA:")
        for i, rod in ipairs(UltimateBypass.AvailableRods) do
            updateStatus(i .. ". " .. rod)
        end
    end
})

BackpackTab:CreateButton({
    Name = "üõçÔ∏è Rod yang Berhasil Dibeli",
    Callback = function()
        if #UltimateBypass.PurchasedRods > 0 then
            updateStatus("üõçÔ∏è RODS BERHASIL DIBELI:")
            for i, rod in ipairs(UltimateBypass.PurchasedRods) do
                updateStatus(i .. ". " .. rod)
            end
        else
            updateStatus("‚ùå Belum ada rods yang berhasil dibeli")
        end
    end
})

-- TAB: ADVANCED BYPASS
local AdvancedTab = Window:CreateTab("‚ö° Advanced Tools")
AdvancedTab:CreateLabel("Advanced Bypass Tools")

AdvancedTab:CreateButton({
    Name = "üíâ Reinject All Bypass",
    Callback = function()
        UltimateBypass:AutoInjectAllBypass()
    end
})

AdvancedTab:CreateButton({
    Name = "üéØ Buy Specific Rod",
    Callback = function()
        AdvancedTab:CreateDropdown({
            Name = "Pilih Rod",
            Options = UltimateBypass.AvailableRods,
            Callback = function(Option)
                local rodName = Option[1]
                if rodName then
                    UltimateBypass:UltimateBuyRod(rodName)
                end
            end
        })
    end
})

AdvancedTab:CreateButton({
    Name = "üîß Debug Backpack System",
    Callback = function()
        updateStatus("üîß DEBUG BACKPACK SYSTEM:")
        
        -- Cek backpack structure
        local backpack = localPlayer:FindFirstChild("Backpack")
        if backpack then
            updateStatus("‚úÖ Backpack ditemukan")
            updateStatus("üìÅ Children: " .. #backpack:GetChildren())
            
            -- Scan structure
            local function printStructure(folder, depth)
                local prefix = string.rep("  ", depth)
                for _, item in pairs(folder:GetChildren()) do
                    updateStatus(prefix .. "üìÑ " .. item.Name .. " (" .. item.ClassName .. ")")
                    if item:IsA("Folder") then
                        printStructure(item, depth + 1)
                    end
                end
            end
            
            printStructure(backpack, 0)
        else
            updateStatus("‚ùå Backpack tidak ditemukan")
        end
    end
})

-- Inisialisasi
updateStatus("üé£ FISH IT ULTIMATE BYPASS LOADED!")
updateStatus("üíâ AUTO INJECTING BYPASS METHODS...")
updateStatus("üöÄ Pergi ke tab 'Ultimate Auto Buy' untuk mulai!")

-- Auto backup check
task.spawn(function()
    task.wait(5)
    updateStatus("‚úÖ System ready! Semua bypass aktif permanen!")
    updateStatus("üí° Rod akan langsung masuk backpack ketika dibeli!")
end)

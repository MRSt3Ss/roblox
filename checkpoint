-- SadsXBons Ultimate GUI Script Roblox (Solara executor)
-- Full version with: Fly, Checkpoints, Save/Load (file browser), Settings, TP-to-Player (scan/search/TP/GetHere)
-- NOTE: Designed for use with exploit executors (Solara) that allow file APIs (listfiles/readfile/writefile/isfile).

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local LocalPlayer = Players.LocalPlayer

-- ===== Variables =====
local flying = false
local flySpeed = 50
local godMode = false
local walkSpeed = 16
local checkpoints = {}            -- array of Vector3
local teleporting = false
local bodyVelocity = nil

-- Default save name
local saveFileName = "default_config.json"

-- ===== Helpers =====
local function notif(msg)
	local notifGui = Instance.new("ScreenGui")
	notifGui.Name = "SadsXBons_Notification"
	notifGui.ResetOnSpawn = false
	notifGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
	
	local Frame = Instance.new("Frame", notifGui)
	Frame.Size = UDim2.new(0, 300, 0, 50)
	Frame.Position = UDim2.new(0.5, -150, 0.85, 0)
	Frame.AnchorPoint = Vector2.new(0.5, 0.5)
	Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
	Frame.BorderSizePixel = 0
	Frame.BackgroundTransparency = 1
	
	local Label = Instance.new("TextLabel", Frame)
	Label.Size = UDim2.new(1, -20, 1, 0)
	Label.Position = UDim2.new(0, 10, 0, 0)
	Label.BackgroundTransparency = 1
	Label.Font = Enum.Font.GothamBold
	Label.TextSize = 20
	Label.TextColor3 = Color3.fromRGB(255,100,100)
	Label.Text = msg
	
	spawn(function()
		for i=1,20 do wait(0.02) Frame.BackgroundTransparency = Frame.BackgroundTransparency - 0.04 end
		wait(1.1)
		for i=1,20 do wait(0.02) Frame.BackgroundTransparency = Frame.BackgroundTransparency + 0.04 end
		notifGui:Destroy()
	end)
end

local function safeDecodeJSON(s)
	local ok, t = pcall(function() return HttpService:JSONDecode(s) end)
	if ok then return t end
	return nil
end

-- ===== UI =====
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SadsXBonsGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 540, 0, 540)
MainFrame.Position = UDim2.new(0.5, -270, 0.5, -270)
MainFrame.BackgroundColor3 = Color3.fromRGB(18,18,18)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true

-- Header
local Header = Instance.new("Frame", MainFrame)
Header.Size = UDim2.new(1,0,0,48)
Header.Position = UDim2.new(0,0,0,0)
Header.BackgroundColor3 = Color3.fromRGB(32,32,32)

local Logo = Instance.new("TextLabel", Header)
Logo.Text = "SadsXBons"
Logo.Font = Enum.Font.PatrickHand
Logo.TextSize = 28
Logo.TextColor3 = Color3.fromRGB(255,100,100)
Logo.BackgroundTransparency = 1
Logo.Position = UDim2.new(0,12,0,6)
Logo.Size = UDim2.new(0,240,1,0)

local CloseBtn = Instance.new("TextButton", Header)
CloseBtn.Text = "X"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 20
CloseBtn.Size = UDim2.new(0,42,0,36)
CloseBtn.Position = UDim2.new(1,-50,0,6)
CloseBtn.BackgroundColor3 = Color3.fromRGB(170,50,50)

local MinBtn = Instance.new("TextButton", Header)
MinBtn.Text = "_"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 22
MinBtn.Size = UDim2.new(0,42,0,36)
MinBtn.Position = UDim2.new(1,-100,0,6)
MinBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)

-- Tabs
local Tabs = Instance.new("Frame", MainFrame)
Tabs.Size = UDim2.new(1,0,0,44)
Tabs.Position = UDim2.new(0,0,0,48)
Tabs.BackgroundTransparency = 1

local function makeTabBtn(text, x)
	local b = Instance.new("TextButton", Tabs)
	b.Text = text
	b.Font = Enum.Font.GothamBold
	b.TextSize = 18
	b.Size = UDim2.new(0,120,1,0)
	b.Position = UDim2.new(0,12 + x*124, 0, 0)
	b.BackgroundColor3 = Color3.fromRGB(38,38,38)
	b.TextColor3 = Color3.fromRGB(220,220,220)
	return b
end

local FlyTabBtn = makeTabBtn("Fly", 0)
local CPTabBtn = makeTabBtn("Checkpoints", 1)
local PlayerTabBtn = makeTabBtn("TP to Player", 2)
local SettingsTabBtn = makeTabBtn("Settings", 3)

-- Container for tab content
local Content = Instance.new("Frame", MainFrame)
Content.Size = UDim2.new(1,-12,1,-110)
Content.Position = UDim2.new(0,6,0,100)
Content.BackgroundTransparency = 1

-- --- Fly Tab ---
local FlyTab = Instance.new("Frame", Content)
FlyTab.Size = UDim2.new(1,0,1,0)
FlyTab.BackgroundTransparency = 1

local FlyToggle = Instance.new("TextButton", FlyTab)
FlyToggle.Text = "Fly: OFF"
FlyToggle.Font = Enum.Font.GothamBold
FlyToggle.TextSize = 20
FlyToggle.Size = UDim2.new(0,160,0,46)
FlyToggle.Position = UDim2.new(0,12,0,12)
FlyToggle.BackgroundColor3 = Color3.fromRGB(90,90,90)

local FlySpeedLabel = Instance.new("TextLabel", FlyTab)
FlySpeedLabel.Text = "Fly Speed: "..flySpeed
FlySpeedLabel.Font = Enum.Font.Gotham
FlySpeedLabel.TextSize = 18
FlySpeedLabel.Position = UDim2.new(0,12,0,68)
FlySpeedLabel.BackgroundTransparency = 1
FlySpeedLabel.TextColor3 = Color3.fromRGB(230,230,230)

local FlySpeedSlider = Instance.new("Frame", FlyTab)
FlySpeedSlider.Size = UDim2.new(0,260,0,18)
FlySpeedSlider.Position = UDim2.new(0,12,0,100)
FlySpeedSlider.BackgroundColor3 = Color3.fromRGB(60,60,60)

local FlyFill = Instance.new("Frame", FlySpeedSlider)
FlyFill.Size = UDim2.new(flySpeed/100,0,1,0)
FlyFill.BackgroundColor3 = Color3.fromRGB(255,100,100)

-- --- Checkpoints Tab ---
local CPTab = Instance.new("Frame", Content)
CPTab.Size = UDim2.new(1,0,1,0)
CPTab.BackgroundTransparency = 1
CPTab.Visible = false

local AddCPBtn = Instance.new("TextButton", CPTab)
AddCPBtn.Text = "Add Checkpoint"
AddCPBtn.Font = Enum.Font.GothamBold
AddCPBtn.TextSize = 18
AddCPBtn.Size = UDim2.new(0,180,0,42)
AddCPBtn.Position = UDim2.new(0,12,0,12)
AddCPBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)

local RunCPBtn = Instance.new("TextButton", CPTab)
RunCPBtn.Text = "Run"
RunCPBtn.Font = Enum.Font.GothamBold
RunCPBtn.TextSize = 18
RunCPBtn.Size = UDim2.new(0,120,0,42)
RunCPBtn.Position = UDim2.new(0,210,0,12)
RunCPBtn.BackgroundColor3 = Color3.fromRGB(255,100,100)

local CPList = Instance.new("ScrollingFrame", CPTab)
CPList.Size = UDim2.new(1,-24,1,-80)
CPList.Position = UDim2.new(0,12,0,70)
CPList.BackgroundColor3 = Color3.fromRGB(30,30,30)
CPList.ScrollBarThickness = 8

local CPListLayout = Instance.new("UIListLayout", CPList)
CPListLayout.SortOrder = Enum.SortOrder.LayoutOrder
CPListLayout.Padding = UDim.new(0,6)

-- --- Player Tab (new TP to Player) ---
local PlayerTab = Instance.new("Frame", Content)
PlayerTab.Size = UDim2.new(1,0,1,0)
PlayerTab.BackgroundTransparency = 1
PlayerTab.Visible = false

local ScanBtn = Instance.new("TextButton", PlayerTab)
ScanBtn.Text = "Scan All Players"
ScanBtn.Font = Enum.Font.GothamBold
ScanBtn.TextSize = 16
ScanBtn.Size = UDim2.new(0,180,0,40)
ScanBtn.Position = UDim2.new(0,12,0,12)
ScanBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)

local SearchBox = Instance.new("TextBox", PlayerTab)
SearchBox.PlaceholderText = "Search player name..."
SearchBox.Font = Enum.Font.Gotham
SearchBox.TextSize = 16
SearchBox.Size = UDim2.new(0,240,0,40)
SearchBox.Position = UDim2.new(0,210,0,12)
SearchBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
SearchBox.TextColor3 = Color3.fromRGB(230,230,230)

local PlayerList = Instance.new("ScrollingFrame", PlayerTab)
PlayerList.Size = UDim2.new(1,-24,1,-80)
PlayerList.Position = UDim2.new(0,12,0,70)
PlayerList.BackgroundColor3 = Color3.fromRGB(30,30,30)
PlayerList.ScrollBarThickness = 8

local PlayerListLayout = Instance.new("UIListLayout", PlayerList)
PlayerListLayout.SortOrder = Enum.SortOrder.LayoutOrder
PlayerListLayout.Padding = UDim.new(0,6)

-- --- Settings Tab ---
local SettingsTab = Instance.new("Frame", Content)
SettingsTab.Size = UDim2.new(1,0,1,0)
SettingsTab.BackgroundTransparency = 1
SettingsTab.Visible = false

local GodToggle = Instance.new("TextButton", SettingsTab)
GodToggle.Text = "GodMode: OFF"
GodToggle.Font = Enum.Font.GothamBold
GodToggle.TextSize = 18
GodToggle.Size = UDim2.new(0,180,0,42)
GodToggle.Position = UDim2.new(0,12,0,12)
GodToggle.BackgroundColor3 = Color3.fromRGB(80,80,80)

local WalkLabel = Instance.new("TextLabel", SettingsTab)
WalkLabel.Text = "WalkSpeed: "..walkSpeed
WalkLabel.Font = Enum.Font.Gotham
WalkLabel.TextSize = 16
WalkLabel.BackgroundTransparency = 1
WalkLabel.Position = UDim2.new(0,12,0,70)
WalkLabel.TextColor3 = Color3.fromRGB(230,230,230)

local WalkSlider = Instance.new("Frame", SettingsTab)
WalkSlider.Size = UDim2.new(0,260,0,18)
WalkSlider.Position = UDim2.new(0,12,0,100)
WalkSlider.BackgroundColor3 = Color3.fromRGB(60,60,60)

local WalkFill = Instance.new("Frame", WalkSlider)
WalkFill.Size = UDim2.new(walkSpeed/100,0,1,0)
WalkFill.BackgroundColor3 = Color3.fromRGB(255,100,100)

local SaveBtn = Instance.new("TextButton", SettingsTab)
SaveBtn.Text = "Save Config"
SaveBtn.Font = Enum.Font.GothamBold
SaveBtn.TextSize = 18
SaveBtn.Size = UDim2.new(0,150,0,40)
SaveBtn.Position = UDim2.new(0,12,1,-56)
SaveBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)

local LoadBtn = Instance.new("TextButton", SettingsTab)
LoadBtn.Text = "Load Config"
LoadBtn.Font = Enum.Font.GothamBold
LoadBtn.TextSize = 18
LoadBtn.Size = UDim2.new(0,150,0,40)
LoadBtn.Position = UDim2.new(0,180,1,-56)
LoadBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)

-- File Browser Frame
local FileBrowser = Instance.new("Frame", ScreenGui)
FileBrowser.Size = UDim2.new(0,420,0,360)
FileBrowser.Position = UDim2.new(0.5,-210,0.5,-180)
FileBrowser.BackgroundColor3 = Color3.fromRGB(22,22,22)
FileBrowser.BorderSizePixel = 0
FileBrowser.Visible = false

local FBHeader = Instance.new("Frame", FileBrowser)
FBHeader.Size = UDim2.new(1,0,0,44)
FBHeader.BackgroundColor3 = Color3.fromRGB(32,32,32)

local FBTitle = Instance.new("TextLabel", FBHeader)
FBTitle.Text = "Load Config - Select a .json"
FBTitle.Font = Enum.Font.GothamBold
FBTitle.TextSize = 18
FBTitle.BackgroundTransparency = 1
FBTitle.TextColor3 = Color3.fromRGB(255,100,100)
FBTitle.Position = UDim2.new(0,12,0,6)

local FBClose = Instance.new("TextButton", FBHeader)
FBClose.Text = "X"
FBClose.Size = UDim2.new(0,40,1,0)
FBClose.Position = UDim2.new(1,-48,0,0)
FBClose.BackgroundColor3 = Color3.fromRGB(170,50,50)

local FBList = Instance.new("ScrollingFrame", FileBrowser)
FBList.Size = UDim2.new(1,-24,1,-64)
FBList.Position = UDim2.new(0,12,0,52)
FBList.BackgroundColor3 = Color3.fromRGB(28,28,28)

local FBLayout = Instance.new("UIListLayout", FBList)
FBLayout.SortOrder = Enum.SortOrder.LayoutOrder
FBLayout.Padding = UDim.new(0,6)

-- ===== Utility Functions for UI refreshes =====
local function refreshCPListUI()
	for _, child in pairs(CPList:GetChildren()) do
		if child:IsA("TextLabel") then child:Destroy() end
	end
	for i, pos in ipairs(checkpoints) do
		local lbl = Instance.new("TextLabel", CPList)
		lbl.Size = UDim2.new(1,-12,0,32)
		lbl.BackgroundColor3 = Color3.fromRGB(42,42,42)
		lbl.TextColor3 = Color3.fromRGB(230,230,230)
		lbl.Font = Enum.Font.Gotham
		lbl.TextSize = 16
		lbl.Text = ("cp%d : x=%.1f y=%.1f z=%.1f"):format(i, pos.X, pos.Y, pos.Z)
		lbl.TextXAlignment = Enum.TextXAlignment.Left
	end
	local layout = CPList:FindFirstChildOfClass("UIListLayout")
	if layout then
		CPList.CanvasSize = UDim2.new(0,0,0, layout.AbsoluteContentSize.Y + 12)
	end
end

local function refreshPlayerListUI(filter)
	filter = filter and filter:lower() or ""
	for _, child in pairs(PlayerList:GetChildren()) do
		if child:IsA("Frame") then child:Destroy() end
	end
	for _, pl in ipairs(Players:GetPlayers()) do
		if pl ~= LocalPlayer and pl.Name:lower():find(filter) or pl.DisplayName:lower():find(filter) then
			-- player entry
			local entry = Instance.new("Frame", PlayerList)
			entry.Size = UDim2.new(1,-12,0,44)
			entry.BackgroundColor3 = Color3.fromRGB(38,38,38)
			
			local nameLbl = Instance.new("TextLabel", entry)
			nameLbl.Text = pl.Name.." | "..(pl.DisplayName or "")
			nameLbl.Font = Enum.Font.Gotham
			nameLbl.TextSize = 16
			nameLbl.TextColor3 = Color3.fromRGB(230,230,230)
			nameLbl.BackgroundTransparency = 1
			nameLbl.Size = UDim2.new(0.6,0,1,0)
			nameLbl.Position = UDim2.new(0,8,0,0)
			nameLbl.TextXAlignment = Enum.TextXAlignment.Left
			
			local tpBtn = Instance.new("TextButton", entry)
			tpBtn.Text = "TP"
			tpBtn.Size = UDim2.new(0,80,0,30)
			tpBtn.Position = UDim2.new(0.62,8,0,7)
			tpBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
			tpBtn.Font = Enum.Font.GothamBold
			tpBtn.TextSize = 14
			
			local getBtn = Instance.new("TextButton", entry)
			getBtn.Text = "GetHere"
			getBtn.Size = UDim2.new(0,80,0,30)
			getBtn.Position = UDim2.new(0.82,8,0,7)
			getBtn.BackgroundColor3 = Color3.fromRGB(255,100,100)
			getBtn.Font = Enum.Font.GothamBold
			getBtn.TextSize = 14
			
			-- actions
			tpBtn.MouseButton1Click:Connect(function()
				-- TP to player: teleport localplayer to target player's HRP
				local ok, char = pcall(function() return pl.Character end)
				if not ok or not char then notif("Player character not available") return end
				local hrp = char:FindFirstChild("HumanoidRootPart")
				local myChar = LocalPlayer.Character
				if hrp and myChar and myChar:FindFirstChild("HumanoidRootPart") then
					pcall(function() myChar.HumanoidRootPart.CFrame = hrp.CFrame + Vector3.new(0,3,0) end)
				else
					notif("TP failed: missing HRP")
				end
			end)
			
			getBtn.MouseButton1Click:Connect(function()
				-- GetHere: attempt to move target player's HRP to local player's HRP
				local ok, char = pcall(function() return pl.Character end)
				if not ok or not char then notif("Player character not available") return end
				local targetHRP = char:FindFirstChild("HumanoidRootPart")
				local myChar = LocalPlayer.Character
				if targetHRP and myChar and myChar:FindFirstChild("HumanoidRootPart") then
					-- Use pcall because many servers protect remote changes; with exploit this may work
					pcall(function()
						targetHRP.CFrame = myChar.HumanoidRootPart.CFrame + Vector3.new(0,1,0)
					end)
				else
					notif("GetHere failed: missing HRP")
				end
			end)
		end
	end
	-- adjust canvas
	local layout = PlayerList:FindFirstChildOfClass("UIListLayout")
	if layout then
		PlayerList.CanvasSize = UDim2.new(0,0,0, layout.AbsoluteContentSize.Y + 12)
	end
end

-- ===== File Browser handling =====
local function refreshFileBrowser()
	for _, c in pairs(FBList:GetChildren()) do
		if c:IsA("TextButton") then c:Destroy() end
	end
	-- listfiles may not exist; try safe call
	local files = {}
	if listfiles then
		local ok, res = pcall(function() return listfiles("") end)
		if ok and type(res) == "table" then
			for _, f in ipairs(res) do
				if tostring(f):lower():match("%.json$") then table.insert(files, f) end
			end
		end
	end
	table.sort(files)
	if #files == 0 then
		local lbl = Instance.new("TextLabel", FBList)
		lbl.Text = "No .json config files found."
		lbl.Size = UDim2.new(1,0,0,36)
		lbl.BackgroundTransparency = 1
		lbl.TextColor3 = Color3.fromRGB(160,160,160)
	else
		for _, f in ipairs(files) do
			local btn = Instance.new("TextButton", FBList)
			btn.Text = f
			btn.Font = Enum.Font.Gotham
			btn.TextSize = 16
			btn.Size = UDim2.new(1,0,0,36)
			btn.BackgroundColor3 = Color3.fromRGB(44,44,44)
			btn.MouseButton1Click:Connect(function()
				-- load file
				FileBrowser.Visible = false
				-- load config
				if isfile and isfile(f) then
					local ok2, data = pcall(function() return readfile(f) end)
					if ok2 and data then
						local cfg = safeDecodeJSON(data)
						if cfg then
							-- apply
							flySpeed = cfg.flySpeed or flySpeed
							godMode = cfg.godMode or godMode
							walkSpeed = cfg.walkSpeed or walkSpeed
							checkpoints = {}
							if cfg.checkpoints then
								for i, cp in ipairs(cfg.checkpoints) do
									if type(cp) == "table" and cp.x and cp.y and cp.z then
										table.insert(checkpoints, Vector3.new(cp.x, cp.y, cp.z))
									end
								end
							end
							
							-- update UI
							FlyFill.Size = UDim2.new(flySpeed/100,0,1,0)
							FlySpeedLabel.Text = "Fly Speed: "..flySpeed
							WalkFill.Size = UDim2.new(walkSpeed/100,0,1,0)
							WalkLabel.Text = "WalkSpeed: "..walkSpeed
							GodToggle.Text = "GodMode: "..(godMode and "ON" or "OFF")
							refreshCPListUI()
							notif("Config loaded: "..f)
						else
							notif("Load failed: invalid json")
						end
					else
						notif("Load failed: can't read file")
					end
				else
					notif("Load failed: file not accessible")
				end
			end)
		end
	end
end

-- ===== Save / Load functions =====
local function promptInput(title, default, callback)
	local g = Instance.new("ScreenGui")
	g.Name = "SadsXBons_Prompt"
	g.ResetOnSpawn = false
	g.Parent = LocalPlayer:WaitForChild("PlayerGui")
	
	local f = Instance.new("Frame", g)
	f.Size = UDim2.new(0,380,0,120)
	f.Position = UDim2.new(0.5,-190,0.5,-60)
	f.BackgroundColor3 = Color3.fromRGB(28,28,28)
	f.BorderSizePixel = 0
	
	local lbl = Instance.new("TextLabel", f)
	lbl.Size = UDim2.new(1,-24,0,36)
	lbl.Position = UDim2.new(0,12,0,8)
	lbl.BackgroundTransparency = 1
	lbl.Font = Enum.Font.GothamBold
	lbl.TextSize = 18
	lbl.TextColor3 = Color3.fromRGB(255,100,100)
	lbl.Text = title
	
	local tb = Instance.new("TextBox", f)
	tb.Size = UDim2.new(1,-24,0,36)
	tb.Position = UDim2.new(0,12,0,48)
	tb.Font = Enum.Font.Gotham
	tb.TextSize = 16
	tb.Text = default or ""
	tb.ClearTextOnFocus = false
	tb.BackgroundColor3 = Color3.fromRGB(40,40,40)
	tb.TextColor3 = Color3.fromRGB(230,230,230)
	
	local saveBtn = Instance.new("TextButton", f)
	saveBtn.Size = UDim2.new(0,120,0,30)
	saveBtn.Position = UDim2.new(1,-140,1,-40)
	saveBtn.Text = "Save"
	saveBtn.Font = Enum.Font.GothamBold
	saveBtn.TextSize = 16
	saveBtn.BackgroundColor3 = Color3.fromRGB(255,100,100)
	
	local function close()
		pcall(function() g:Destroy() end)
	end
	
	local function doSave()
		local text = tb.Text
		if text and text ~= "" then
			close()
			callback(text)
		else
			notif("Masukkan nama file valid")
		end
	end
	
	saveBtn.MouseButton1Click:Connect(doSave)
	tb.FocusLost:Connect(function(enter)
		if enter then doSave() end
	end)
end

local function saveConfig()
	promptInput("Masukkan nama file save config (contoh: cp map A):", saveFileName, function(name)
		if not name:lower():match("%.json$") then name = name .. ".json" end
		local cfg = {
			flySpeed = flySpeed,
			godMode = godMode,
			walkSpeed = walkSpeed,
			checkpoints = {}
		}
		for i, v in ipairs(checkpoints) do
			cfg.checkpoints[i] = { x = v.X, y = v.Y, z = v.Z }
		end
		local json = HttpService:JSONEncode(cfg)
		local ok, err = pcall(function() writefile(name, json) end)
		if ok then
			saveFileName = name
			notif("Save config berhasil: "..name)
		else
			notif("Save failed: "..tostring(err))
		end
	end)
end

-- ===== Fly implementation =====
local function startFly()
	if bodyVelocity then return end
	local char = LocalPlayer.Character
	if not char then return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	bodyVelocity = Instance.new("BodyVelocity")
	bodyVelocity.MaxForce = Vector3.new(1e5,1e5,1e5)
	bodyVelocity.Velocity = Vector3.new(0,0,0)
	bodyVelocity.Parent = hrp
	
	RunService:BindToRenderStep("SadsXBons_Fly", Enum.RenderPriority.Character.Value + 1, function()
		if not bodyVelocity or not hrp then return end
		local dir = Vector3.new(0,0,0)
		if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir = dir + workspace.CurrentCamera.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir = dir - workspace.CurrentCamera.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir = dir - workspace.CurrentCamera.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir = dir + workspace.CurrentCamera.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0,1,0) end
		if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then dir = dir - Vector3.new(0,1,0) end
		if dir.Magnitude > 0 then
			bodyVelocity.Velocity = dir.Unit * flySpeed
		else
			bodyVelocity.Velocity = Vector3.new(0,0,0)
		end
	end)
end

local function stopFly()
	if bodyVelocity then
		pcall(function() bodyVelocity:Destroy() end)
		bodyVelocity = nil
		pcall(function() RunService:UnbindFromRenderStep("SadsXBons_Fly") end)
	end
end

-- ===== Checkpoint functions =====
local function addCheckpoint()
	local char = LocalPlayer.Character
	if not char then notif("Character not found") return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then notif("HumanoidRootPart not found") return end
	table.insert(checkpoints, hrp.Position)
	refreshCPListUI()
end

local function runCheckpoints()
	if teleporting then return end
	if #checkpoints == 0 then notif("No checkpoints") return end
	teleporting = true
	local char = LocalPlayer.Character
	if not char then teleporting = false return end
	local hrp = char:FindFirstChild("HumanoidRootPart")
	if not hrp then teleporting = false return end
	for _, pos in ipairs(checkpoints) do
		pcall(function()
			hrp.CFrame = CFrame.new(pos + Vector3.new(0,3,0))
		end)
		wait(0.9)
	end
	teleporting = false
end

-- ===== Events & interactions =====
-- Tabs switching
local function switchTo(tabName)
	FlyTab.Visible = (tabName == "Fly")
	CPTab.Visible = (tabName == "CP")
	PlayerTab.Visible = (tabName == "Player")
	SettingsTab.Visible = (tabName == "Settings")
	-- styling
	FlyTabBtn.BackgroundColor3 = (tabName=="Fly") and Color3.fromRGB(60,60,60) or Color3.fromRGB(38,38,38)
	CPTabBtn.BackgroundColor3 = (tabName=="CP") and Color3.fromRGB(60,60,60) or Color3.fromRGB(38,38,38)
	PlayerTabBtn.BackgroundColor3 = (tabName=="Player") and Color3.fromRGB(60,60,60) or Color3.fromRGB(38,38,38)
	SettingsTabBtn.BackgroundColor3 = (tabName=="Settings") and Color3.fromRGB(60,60,60) or Color3.fromRGB(38,38,38)
end

FlyTabBtn.MouseButton1Click:Connect(function() switchTo("Fly") end)
CPTabBtn.MouseButton1Click:Connect(function() switchTo("CP") end)
PlayerTabBtn.MouseButton1Click:Connect(function() switchTo("Player") end)
SettingsTabBtn.MouseButton1Click:Connect(function() switchTo("Settings") end)

-- Close / Minimize
CloseBtn.MouseButton1Click:Connect(function()
	ScreenGui:Destroy()
end)
MinBtn.MouseButton1Click:Connect(function()
	MainFrame.Visible = false
end)

-- Fly toggle
FlyToggle.MouseButton1Click:Connect(function()
	if bodyVelocity then
		FlyToggle.Text = "Fly: OFF"
		FlyToggle.BackgroundColor3 = Color3.fromRGB(90,90,90)
		stopFly()
	else
		FlyToggle.Text = "Fly: ON"
		FlyToggle.BackgroundColor3 = Color3.fromRGB(255,100,100)
		startFly()
	end
end)

-- Fly slider drag
do
	local dragging = false
	FlySpeedSlider.InputBegan:Connect(function(inp)
		if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
	end)
	FlySpeedSlider.InputEnded:Connect(function(inp)
		if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
	end)
	FlySpeedSlider.InputChanged:Connect(function(inp)
		if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then
			local x = math.clamp(inp.Position.X - FlySpeedSlider.AbsolutePosition.X, 0, FlySpeedSlider.AbsoluteSize.X)
			flySpeed = math.max(1, math.floor((x / FlySpeedSlider.AbsoluteSize.X) * 100))
			FlyFill.Size = UDim2.new(flySpeed/100,0,1,0)
			FlySpeedLabel.Text = "Fly Speed: "..flySpeed
		end
	end)
end

-- Add checkpoint / run
AddCPBtn.MouseButton1Click:Connect(addCheckpoint)
RunCPBtn.MouseButton1Click:Connect(runCheckpoints)

-- Player scan & search
ScanBtn.MouseButton1Click:Connect(function()
	refreshPlayerListUI()
	notif("Scanned players")
end)
SearchBox.FocusLost:Connect(function(enter)
	if enter then
		local q = SearchBox.Text or ""
		refreshPlayerListUI(q)
	end
end)
SearchBox.Changed:Connect(function(prop)
	if prop == "Text" then
		-- live filter
		refreshPlayerListUI(SearchBox.Text)
	end
end)

-- Walkspeed slider
do
	local dragging = false
	WalkSlider.InputBegan:Connect(function(inp)
		if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
	end)
	WalkSlider.InputEnded:Connect(function(inp)
		if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
	end)
	WalkSlider.InputChanged:Connect(function(inp)
		if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then
			local x = math.clamp(inp.Position.X - WalkSlider.AbsolutePosition.X, 0, WalkSlider.AbsoluteSize.X)
			walkSpeed = math.max(1, math.floor((x / WalkSlider.AbsoluteSize.X) * 100))
			WalkFill.Size = UDim2.new(walkSpeed/100,0,1,0)
			WalkLabel.Text = "WalkSpeed: "..walkSpeed
			local char = LocalPlayer.Character
			if char then
				local humanoid = char:FindFirstChildOfClass("Humanoid")
				if humanoid then pcall(function() humanoid.WalkSpeed = walkSpeed end) end
			end
		end
	end)
end

-- Godmode toggle
GodToggle.MouseButton1Click:Connect(function()
	godMode = not godMode
	GodToggle.Text = "GodMode: "..(godMode and "ON" or "OFF")
	GodToggle.BackgroundColor3 = godMode and Color3.fromRGB(255,100,100) or Color3.fromRGB(80,80,80)
	local char = LocalPlayer.Character
	if char then
		local humanoid = char:FindFirstChildOfClass("Humanoid")
		if humanoid then
			if godMode then
				pcall(function() humanoid.MaxHealth = math.huge humanoid.Health = math.huge end)
			else
				pcall(function() humanoid.MaxHealth = 100 humanoid.Health = 100 end)
			end
		end
	end
end)

-- Save / Load buttons
SaveBtn.MouseButton1Click:Connect(saveConfig)
LoadBtn.MouseButton1Click:Connect(function()
	refreshFileBrowser()
	FileBrowser.Visible = true
end)
FBClose.MouseButton1Click:Connect(function() FileBrowser.Visible = false end)

-- Initial UI states
refreshCPListUI()
refreshPlayerListUI()

-- Ensure player's humanoid updates on spawn
Players.LocalPlayer.CharacterAdded:Connect(function(char)
	wait(0.8)
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if humanoid then
		pcall(function() humanoid.WalkSpeed = walkSpeed end)
		if godMode then pcall(function() humanoid.MaxHealth = math.huge humanoid.Health = math.huge end) end
	end
end)

-- End of script
-- Enjoy. If you want tweaks (confirm prompt styling, confirmation dialogs, cooldowns for GetHere, safety checks), tell me and I'll update.
